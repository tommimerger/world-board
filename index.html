<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>World Board ‚Äì Live Times & Weather</title>
  <!--
    This page displays live local times, relative timezone offsets, sunrise and sunset
    information, and current weather conditions for a set of cities relative to
    Singapore. Weather data and sunrise/sunset times are fetched from the
    open‚Äësource Open‚ÄëMeteo API (https://open-meteo.com) and do not require an API key.

    The Luxon library is used for robust timezone handling and daylight savings
    calculations. See https://moment.github.io/luxon/ for details.
  -->
  <style>
    :root{
      --bg:#0f1117;
      --card-bg:#141923;
      --card-fg:#e9eef6;
      --muted:#99a3b2;
      --primary:#5aa9ff;
      --highlight:#1e61a3;
      --border-radius:12px;
      --gap:16px;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;
      background:var(--bg);
      color:var(--card-fg);
      line-height:1.4;
      padding:20px;
    }
    h1{ font-size:1.6rem; margin-bottom:1rem; text-align:center; }
    .cards{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap:var(--gap);
      margin-bottom:28px;
    }
    .card{
      background:var(--card-bg);
      border-radius:var(--border-radius);
      position:relative;
      overflow:hidden;
      padding:16px 14px 20px;
      box-shadow:0 6px 18px rgba(0,0,0,0.4);
    }
    .card .image{
      position:absolute;
      top:0; left:0; right:0; bottom:0;
      background-size:cover;
      background-position:center;
      opacity:0.2;
      pointer-events:none;
    }
    .card h2{
      font-size:1.2rem;
      margin-bottom:0.2rem;
      font-weight:600;
    }
    .card .time{font-size:1.5rem; font-weight:700; margin-bottom:0.3rem;}
    .card .offset{font-size:0.9rem; color:var(--muted); margin-bottom:0.3rem;}
    .card .sun{
      font-size:0.9rem;
      margin-bottom:0.3rem;
    }
    .card .weather{
      font-size:0.9rem;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .weather-icon{
      font-size:1.2rem;
    }
    .timeline{
      overflow-x:auto;
      border-collapse:collapse;
      width:100%;
      font-size:0.85rem;
    }
    .timeline th,
    .timeline td{
      border:1px solid #202431;
      padding:6px 4px;
      text-align:center;
      min-width:50px;
    }
    .timeline th.city-name{
      position:sticky;
      left:0;
      background:var(--card-bg);
      z-index:2;
      width:150px;
    }
    .timeline td.current{
      background:var(--highlight);
      color:#fff;
    }
    .timeline tbody tr:nth-child(odd) td.city-name{
      background:#171c27;
    }
  </style>
</head>
<body>
  <h1 id="dateHeading">Loading date‚Ä¶</h1>
  <div id="cards" class="cards"></div>
  <table id="timeline" class="timeline"></table>

  <!-- External library for timezone handling -->
  <script src="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js"></script>
  <script>
    /*
      List of cities with their names, timezones, latitude, longitude and image
      paths. Coordinates are approximate and can be adjusted for greater
      accuracy. The images folder must contain matching images (PNG or JPG).
    */
    const cities = [
      { id:'boise',    name:'Boise',     tz:'America/Boise',    lat:43.615,  lon:-116.2023, image:'images/BOISE.PNG' },
      { id:'houston',  name:'Houston',   tz:'America/Chicago',  lat:29.7604, lon:-95.3698,  image:'images/HOUSTON.PNG' },
      { id:'newyork',  name:'New York',  tz:'America/New_York', lat:40.7128, lon:-74.0060,  image:'images/NYC.PNG' },
      { id:'london',   name:'London',    tz:'Europe/London',    lat:51.5074, lon:-0.1278,   image:'images/LONDON.PNG' },
      { id:'helsinki', name:'Helsinki',  tz:'Europe/Helsinki',  lat:60.1699, lon:24.9384,   image:'images/HELSINKI.PNG' },
      { id:'uae',      name:'UAE',       tz:'Asia/Dubai',       lat:24.4539, lon:54.3773,   image:'images/UAE.PNG' },
      { id:'singapore',name:'Singapore', tz:'Asia/Singapore',   lat:1.3521,  lon:103.8198,  image:'images/SINGAPORE.PNG' }
    ];

    // Mapping of weather codes from Open-Meteo to icons and descriptions
    const weatherSymbols = {
      0: { icon:'‚òÄÔ∏è', desc:'Clear' },
      1: { icon:'üå§Ô∏è', desc:'Mostly clear' },
      2: { icon:'‚õÖ', desc:'Partly cloudy' },
      3: { icon:'‚òÅÔ∏è', desc:'Overcast' },
      45: { icon:'üå´Ô∏è', desc:'Fog' },
      48: { icon:'üå´Ô∏è', desc:'Rime fog' },
      51: { icon:'üå¶Ô∏è', desc:'Light drizzle' },
      53: { icon:'üå¶Ô∏è', desc:'Drizzle' },
      55: { icon:'üå¶Ô∏è', desc:'Dense drizzle' },
      61: { icon:'üåßÔ∏è', desc:'Light rain' },
      63: { icon:'üåßÔ∏è', desc:'Rain' },
      65: { icon:'üåßÔ∏è', desc:'Heavy rain' },
      71: { icon:'üå®Ô∏è', desc:'Light snow' },
      73: { icon:'üå®Ô∏è', desc:'Snow' },
      75: { icon:'üå®Ô∏è', desc:'Heavy snow' },
      95: { icon:'‚õàÔ∏è', desc:'Thunderstorm' },
      96: { icon:'‚õàÔ∏è', desc:'Thunderstorm' },
      99: { icon:'‚õàÔ∏è', desc:'Thunderstorm' }
    };

    // Fetch weather and sunrise/sunset information for a city using Open‚ÄëMeteo
    async function fetchWeatherData(city){
      const url = `https://api.open-meteo.com/v1/forecast?latitude=${city.lat}&longitude=${city.lon}&current_weather=true&daily=sunrise,sunset&timezone=${encodeURIComponent(city.tz)}&temperature_unit=celsius&forecast_days=1`;
      try{
        const response = await fetch(url);
        const data = await response.json();
        const weather = data.current_weather;
        const daily = data.daily || {};
        const sunrise = daily.sunrise ? daily.sunrise[0] : null;
        const sunset  = daily.sunset  ? daily.sunset[0]  : null;
        return {
          temperature: weather ? weather.temperature : null,
          code: weather ? weather.weathercode : null,
          sunrise,
          sunset
        };
      }catch(err){
        console.error('Weather fetch failed for', city.name, err);
        return { temperature:null, code:null, sunrise:null, sunset:null };
      }
    }

    // Build card elements in the DOM
    function renderCards(){
      const container = document.getElementById('cards');
      container.innerHTML = '';
      for(const city of cities){
        const card = document.createElement('div');
        card.className = 'card';
        // background image overlay
        const imageDiv = document.createElement('div');
        imageDiv.className = 'image';
        imageDiv.style.backgroundImage = `url('${city.image}')`;
        card.appendChild(imageDiv);
        // text content
        const h2 = document.createElement('h2');
        h2.textContent = city.name;
        card.appendChild(h2);
        const timeEl = document.createElement('div');
        timeEl.className = 'time';
        timeEl.id = `${city.id}-time`;
        timeEl.textContent = '--:--';
        card.appendChild(timeEl);
        const offEl = document.createElement('div');
        offEl.className = 'offset';
        offEl.id = `${city.id}-offset`;
        offEl.textContent = '';
        card.appendChild(offEl);
        const sunEl = document.createElement('div');
        sunEl.className = 'sun';
        sunEl.id = `${city.id}-sun`;
        sunEl.textContent = '';
        card.appendChild(sunEl);
        const weatherEl = document.createElement('div');
        weatherEl.className = 'weather';
        weatherEl.id = `${city.id}-weather`;
        weatherEl.textContent = '';
        card.appendChild(weatherEl);
        container.appendChild(card);
      }
    }

    // Build the timeline table header and rows
    function renderTimeline(){
      const tbl = document.getElementById('timeline');
      tbl.innerHTML = '';
      // header row: blank cell + 24 columns for each hour
      const head = document.createElement('thead');
      const hrow = document.createElement('tr');
      const blank = document.createElement('th');
      blank.textContent = '';
      blank.className = 'city-name';
      hrow.appendChild(blank);
      // create 24 hour headings from 0:00 to 23:00
      for(let h=0; h<24; h++){
        const th = document.createElement('th');
        th.textContent = `${h}:00`;
        hrow.appendChild(th);
      }
      head.appendChild(hrow);
      tbl.appendChild(head);
      // body rows: one per city
      const tbody = document.createElement('tbody');
      for(const city of cities){
        const row = document.createElement('tr');
        const nameCell = document.createElement('td');
        nameCell.textContent = city.name;
        nameCell.className = 'city-name';
        row.appendChild(nameCell);
        for(let h=0; h<24; h++){
          const td = document.createElement('td');
          td.id = `${city.id}-hour-${h}`;
          td.textContent = '';
          row.appendChild(td);
        }
        tbody.appendChild(row);
      }
      tbl.appendChild(tbody);
    }

    // Update local time, offsets, sunrise/sunset and weather info periodically
    function updateCards(){
      const now = luxon.DateTime.now();
      const sgOffset = now.setZone('Asia/Singapore').offset;
      for(const city of cities){
        const local = now.setZone(city.tz);
        // format time
        const timeEl = document.getElementById(`${city.id}-time`);
        timeEl.textContent = local.toFormat('h:mm a');
        // offset difference
        const offDiff = (local.offset - sgOffset) / 60;
        const offEl = document.getElementById(`${city.id}-offset`);
        if(offDiff === 0){
          offEl.textContent = 'same as Singapore';
        } else {
          const abs = Math.abs(offDiff);
          const hours = abs % 1 === 0 ? abs : abs.toFixed(1);
          offEl.textContent = `${hours} hour${abs>1 ? 's' : ''} ${offDiff > 0 ? 'ahead' : 'behind'} Singapore`;
        }
        // update sunrise/sunset times if available
        const sunEl = document.getElementById(`${city.id}-sun`);
        if(city.sunrise && city.sunset){
          // parse times and convert to local zone string
          const rise = luxon.DateTime.fromISO(city.sunrise, { zone: city.tz });
          const set  = luxon.DateTime.fromISO(city.sunset,  { zone: city.tz });
          sunEl.textContent = `Sunrise ${rise.toFormat('h:mm a')} ¬∑ Sunset ${set.toFormat('h:mm a')}`;
        } else {
          sunEl.textContent = '';
        }
        // weather
        const weatherEl = document.getElementById(`${city.id}-weather`);
        if(city.weather !== undefined && city.code !== undefined){
          const symbol = weatherSymbols[city.code] || { icon:'‚ùì', desc:'Weather' };
          weatherEl.innerHTML = `<span class="weather-icon">${symbol.icon}</span> ${symbol.desc}, ${city.weather != null ? city.weather.toFixed(1)+'¬∞C' : ''}`;
        }
      }
    }

    // Update timeline table for day/night icons and highlight current Singapore hour
    function updateTimeline(){
      const nowSG = luxon.DateTime.now().setZone('Asia/Singapore');
      const currentHourSG = nowSG.hour;
      // iterate through each city and each hour
      for(const city of cities){
        for(let h=0; h<24; h++){
          const cell = document.getElementById(`${city.id}-hour-${h}`);
          // compute local hour at h relative to start of day
          // create date at h:00 in local timezone for current date
          const localDate = nowSG.setZone(city.tz).startOf('day').plus({ hours:h });
          // determine day/night: if sunrise and sunset are defined
          let isDay = true;
          if(city.sunrise && city.sunset){
            const rise = luxon.DateTime.fromISO(city.sunrise, { zone: city.tz });
            const set  = luxon.DateTime.fromISO(city.sunset,  { zone: city.tz });
            isDay = localDate >= rise && localDate < set;
          }
          cell.textContent = isDay ? '‚òÄÔ∏è' : 'üåô';
          cell.classList.remove('current');
        }
      }
      // highlight the column corresponding to current hour in Singapore
      for(const city of cities){
        const cell = document.getElementById(`${city.id}-hour-${currentHourSG}`);
        if(cell){
          cell.classList.add('current');
        }
      }
    }

    // Fetch weather for all cities and set sunrise/sunset
    async function loadWeather(){
      const promises = cities.map(async (city) => {
        const data = await fetchWeatherData(city);
        city.weather = data.temperature;
        city.code    = data.code;
        city.sunrise = data.sunrise;
        city.sunset  = data.sunset;
      });
      await Promise.all(promises);
    }

    // Initialize the board
    async function init(){
      document.getElementById('dateHeading').textContent = luxon.DateTime.now().toFormat('cccc, d LLLL yyyy');
      renderCards();
      renderTimeline();
      await loadWeather();
      updateCards();
      updateTimeline();
      // update time display and timeline every minute
      setInterval(() => {
        updateCards();
        updateTimeline();
      }, 60000);
    }
    init();
  </script>
</body>
</html>
